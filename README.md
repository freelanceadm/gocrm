# Description

# TODO
- tls 
- http2
- db migrations
- API CRUD with gin group routes
- DB CRUD part

- redis cache
- NATS, rabbit, kafka for message queueus

- add static assets
- add templates

- JWT/OATH2/keycloak 

# Done
* add MUX router 
* add /health handler
* add DB connection

# Database

## Create tables manually
!!! Postgres suggest use TEXT and NOT VARCHAR ( varchar is deprecated )
```
CREATE TABLE "users" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "full_name" text NOT NULL,
  "created_at" timestamp DEFAULT (now()),
  "email" text NOT NULL,
  "password" text NOT NULL
);

CREATE INDEX ON "users" ("full_name");

CREATE INDEX ON "users" ("email");

COMMENT ON COLUMN "users"."password" IS 'password hash';
```

## Create tables using GORM

We use GORM to reuse existing connection to database. 

Simply reuse DB connection and call auto migration. 
Example: 
```
	// Get a database handle.
	db = t_sql.ConnectDB()        // *sql.DB
	gdb = t_sql.GormConnectDB(db) // *gorm.DB

	// Migrate schema(s)
	gdb.AutoMigrate(&t_model.User{})   // One model. Otherwise its hungs up. Or may by does not run commit at the end of SQL request
  gdb.AutoMigrate(&t_model.Album{})  // 
``` 

## DB migration
Utility https://gorm.io/docs/migration.html

GORM example of DB table:
// gorm.Model definition
```
type Users struct {
  ID        uint           `gorm:"primaryKey"`
  CreatedAt time.Time `gorm:"->;<-:create"` // allow read and create // Set to current time if it is zero on creating
  Updated   int64 `gorm:"autoUpdateTime"`
  FullName string `gorm:"index"`
  Email     string `gorm:"index:,unique"`
  PasswordHash  string
}
```

# API
## CRUD in database using GORM
```
	// insert multiple records
	t_sql.GormCreateBatch(gdb, &users)

	// insert one record
	t_sql.GormCreateOne(gdb, &user)

	// get one record
	record, _ := t_sql.GormGetByID(gdb, &t_model.User{}, "1")
	log.Println(record)

	// Get all records
	res := []t_model.User{}
	err := t_sql.GormGetAll(gdb, t_model.User{}, &res)
	log.Println(err)
	log.Println("allrecords: ", res)

  // TODO: update and delete
```